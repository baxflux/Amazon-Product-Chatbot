{% load static %}
{% csrf_token %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Product Chatbot</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/chatbot.css' %}">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark fixed-top shadow-sm">
        <div class="container-fluid">
            <a href="/"
            onclick="return false;"
            class="navbar-brand active
                    rounded-pill
                    bg-primary
                    fw-semibold
                    fs-6">
                Chatbot
            </a>
        </div>
    </nav>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Chat History</h3>
                <span class="hamburger" onclick="toggleSidebar()">‚úï</span>
            </div>
            <button class="new-chat-btn" onclick="startNewChat()">New Chat</button>
            {% for session in sessions %}
                <div class="chat-session {% if session.session_key == current_session %}active{% endif %}" 
                     onclick="loadChatSession('{{ session.session_key }}')">
                    <span>Chat #{{ forloop.counter }} ({{ session.message_count }} messages)</span>
                    <span>üó®Ô∏è</span>
                </div>
            {% endfor %}
        </div>
        <div class="chat-container">
            <div class="chat-header">
                <span class="hamburger" onclick="toggleSidebar()">‚ò∞</span>
                <span>Amazon Product Chatbot</span>
                <span></span>
            </div>
            <div id="chatbox">
                <div class="welcome-message">
                    <img src="{% static 'images/bot.png' %}" class="avatar bot-avatar" alt="Bot Avatar">
                    <div class="message">Hello! I'm Amazon Product Chatbot. Enter a keyword 'tablet' or ask me 'Tell me about B01AHB9CN2' to get started!</div>
                </div>
                {% for message in chat_history %}
                    <div class="message-container {% if message.is_user %}user-message-container{% endif %}">
                        {% if not message.is_user %}
                            <img src="{% static 'images/bot.png' %}" class="avatar bot-avatar" alt="Bot Avatar">
                        {% endif %}
                        <div class="message {% if message.is_user %}user-message{% endif %}">
                            {{ message.message }}
                            {% if message.is_user and message.sentiment %}
                                <span class="sentiment {{ message.sentiment }}">(Sentiment: {{ message.sentiment }})</span>
                            {% endif %}
                        </div>
                        {% if message.is_user %}
                            <img src="{% static 'images/user.png' %}" class="avatar user-avatar" alt="User Avatar">
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <div id="input-container" class="d-flex align-items-center gap-2 bg-light border-top">
                <input id="input"
                    type="text"
                    class="form-control form-control-sm rounded-pill"
                    placeholder="Input...">

                <button class="btn-info bg-gradient btn-sm rounded-pill"
                        onclick="sendMessage()">
                    Send
                </button>
            </div>
        </div>
    </div>

    <script>
        const USER_AVATAR_URL = "{% static 'images/user.png' %}";
        const BOT_AVATAR_URL  = "{% static 'images/bot.png' %}";
    </script>

    <script src="{% static 'js/chatbot.js' %}"></script>
</body>
</html>